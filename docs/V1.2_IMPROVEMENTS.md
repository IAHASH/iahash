# IA-HASH v1.2 — Mejoras propuestas

Estas acciones ayudan a consolidar la versión 1.2 y a reducir riesgos operativos antes de publicar:

- **Robustecer el flujo de emisión**: añadir validaciones de tipos y tamaños en `POST /api/verify/pair` y `POST /api/verify/conversation`, devolver errores JSON estructurados y registrar los payloads anónimos para auditoría mínima.
- **Autodiagnóstico de claves**: incorporar un endpoint `GET /health/keys` que compruebe existencia y permisos de las claves Ed25519 en `/data/keys`, devolviendo estados "missing", "invalid perms" o "ok".
- **Pruebas de regresión de normalización**: crear casos parametrizados que cubran Unicode NFC, reemplazo de CRLF y trimming final para `iah_from_pair`, evitando divergencias con `PROTOCOL_1.2.md`.
- **Semillas y fixtures coherentes**: documentar y reforzar la carga de `db/seed_prompts.sql` para entornos de CI, incluyendo un comando `python -m iahash.db --seed` que inicialice la base según esquema 1.2.
- **Aislamiento de configuración**: mover valores como `API_VERSION` y `PROTOCOL_VERSION` a un módulo `settings.py` con lectura opcional desde variables de entorno (`IAHASH_PROTOCOL_VERSION`, `IAHASH_API_VERSION`).
- **Telemetría mínima**: exponer métricas de conteo por endpoint vía Prometheus o un middleware que emita logs estructurados con duración, código HTTP y `protocol_version`.
- **Endurecer el UI**: validar en cliente los campos de `/verify` y `/compare`, mostrar mensajes de error localizados y agregar un estado de carga durante la llamada a la API.
- **Paquetes oficiales**: publicar en PyPI un artefacto `iah` con los módulos `crypto`, `issuer`, `verifier` y `models`, incluyendo `__version__` y docs de uso rápido.
- **Caché de claves públicas**: persistir la clave pública del emisor en memoria con invalidación cuando cambie el archivo, evitando lecturas de disco por petición.
- **Hardening de despliegue**: añadir `docker-compose` que monte `/data/keys` con permisos mínimos, configure variables `UVICORN_WORKERS` y permita modo `read-only` para la imagen de producción.
- **Changelog 1.2**: crear `CHANGELOG.md` con secciones `Added/Changed/Fixed/Security` y ejemplo de documento IA-HASH firmado.
- **Integración con CLI**: ofrecer un script `iah-cli` (Typer) que permita emitir, verificar y consultar IA-HASH apuntando a la API, útil para pipelines CI/CD.

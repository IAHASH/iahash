<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IA-HASH · Prompt + Respuesta verificables</title>
    <meta
      name="description"
      content="IA-HASH genera y verifica huellas criptográficas de prompts y respuestas IA usando SHA256 + Ed25519."
    />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="top-bar">
      <div class="top-bar-inner">
        <div class="brand">
          <div class="brand-logo">IA</div>
          <div>
            <div class="brand-title">IA-HASH</div>
            <div class="brand-subtitle">Prompt + Respuesta · Verificables</div>
          </div>
        </div>
        <nav class="top-nav">
          <a href="#hero">Inicio</a>
          <a href="#issuer">Emitir</a>
          <a href="#verifier">Verificar</a>
          <a href="#docs">Docs</a>
          <a href="https://github.com/IAHASH/iahash" target="_blank" rel="noreferrer">GitHub</a>
        </nav>
        <div class="lang-selector">
          <select id="lang-select">
            <option value="es">ES</option>
            <option value="en">EN</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <section id="hero" class="hero">
        <div>
          <p class="eyebrow">Neutral · Offline · Ed25519</p>
          <h1>Firma y verifica cualquier Prompt + Respuesta IA</h1>
          <p class="lede">
            IA-HASH crea un JSON verificable con hashes SHA256 y firma Ed25519. Funciona con ChatGPT, Claude, modelos locales o
            cualquier LLM.
          </p>
          <div class="hero-actions">
            <a class="btn btn-primary" href="#issuer">Emitir IA-HASH</a>
            <a class="btn btn-secondary" href="#verifier">Verificar documento</a>
          </div>
        </div>
        <div class="hero-card">
          <div class="seal">IA-HASH VERIFIED</div>
          <p>Verificación offline años después. Sin blockchain. Sin vendor lock-in.</p>
          <p class="hint">Incluye `conversation_id` para conversaciones completas (estructura lista para v2).</p>
        </div>
      </section>

      <section class="grid">
        <section id="issuer" class="card">
          <header>
            <h2>Issue from Prompt + Response</h2>
            <p>Genera un IA-HASH JSON listo para compartir, auditar o guardar en tu SQL.</p>
          </header>

          <div class="field-group">
            <label for="prompt">Prompt maestro</label>
            <textarea id="prompt" rows="5" placeholder="Texto exacto enviado a la IA"></textarea>
          </div>

          <div class="field-group">
            <label for="response">Respuesta</label>
            <textarea id="response" rows="6" placeholder="Respuesta completa del modelo"></textarea>
          </div>

          <div class="field-grid">
            <div class="field-group">
              <label for="model">Modelo</label>
              <input id="model" placeholder="gpt-5, claude-3, llama3..." />
            </div>
            <div class="field-group">
              <label for="prompt-id">Prompt ID <span class="optional">opcional</span></label>
              <input id="prompt-id" placeholder="cv_v1, diag_psico_v1" />
            </div>
            <div class="field-group">
              <label for="subject-id">Subject ID <span class="optional">opcional</span></label>
              <input id="subject-id" placeholder="user-123, candidato-456" />
            </div>
          </div>

          <div class="field-group">
            <label for="conversation-id">Conversation ID <span class="optional">opcional</span></label>
            <input id="conversation-id" placeholder="chat-abc123 (para conversaciones completas)" />
          </div>

          <div class="actions">
            <button id="btn-issue" class="btn btn-primary" type="button">Generar IA-HASH</button>
            <button id="btn-clear" class="btn" type="button">Limpiar</button>
            <button id="btn-copy" class="btn" type="button">Copiar JSON</button>
            <button id="btn-download" class="btn" type="button">Descargar JSON</button>
            <span id="issue-status" class="status">Listo para emitir.</span>
          </div>

          <pre id="issue-json" class="code">{}</pre>
        </section>

        <section id="verifier" class="card">
          <header>
            <h2>Verify IA-HASH</h2>
            <p>Pega el IA-HASH JSON o usa el último emitido. Verificamos hashes y firma Ed25519.</p>
          </header>

          <div class="field-group">
            <label for="chat-url">ChatGPT share URL <span class="optional">(placeholder)</span></label>
            <input id="chat-url" placeholder="https://chatgpt.com/share/..." />
            <small class="hint">Preparado para validar contra enlaces compartidos (v2).</small>
          </div>

          <div class="field-group">
            <label for="verify-json">Documento IA-HASH</label>
            <textarea id="verify-json" rows="10" class="mono" placeholder='{ "version": "IAHASH-1", ... }'></textarea>
          </div>

          <div class="actions">
            <button id="btn-use-last" class="btn" type="button">Usar último emitido</button>
            <button id="btn-verify" class="btn btn-primary" type="button">Verificar</button>
            <span id="verify-status" class="status">Esperando documento…</span>
          </div>

          <div class="result">
            <div id="verify-badge" class="badge">Sin verificar</div>
            <div id="verify-reason" class="hint"></div>
          </div>
        </section>
      </section>

      <section id="how" class="card">
        <h2>How it works</h2>
        <ol class="steps">
          <li><strong>Normalise</strong> prompt y respuesta (saltos de línea y espacios finales).</li>
          <li><strong>Hash</strong> cada parte con SHA256 → `h_prompt`, `h_respuesta`.</li>
          <li><strong>Combine</strong> `version | prompt_id | h_prompt | h_respuesta | modelo | timestamp` → `h_total`.</li>
          <li><strong>Sign</strong> `h_total` con Ed25519 → `firma_total`.</li>
          <li><strong>Verify</strong> recalculando todo con la clave pública desde `/public-key`.</li>
        </ol>
      </section>

      <section class="card" id="use-cases">
        <h2>Use cases</h2>
        <div class="pill-grid">
          <span class="pill">CVs verificables</span>
          <span class="pill">Evaluaciones técnicas</span>
          <span class="pill">Auditoría IA</span>
          <span class="pill">Reportes legales</span>
          <span class="pill">Educación</span>
          <span class="pill">Modelos locales</span>
        </div>
      </section>

      <section class="card" id="master-prompts">
        <h2>Master Prompts</h2>
        <p>Explora plantillas listas para emitir IA-HASH (placeholder, pronto editable desde la API).</p>
        <ul class="master-list">
          <li><strong>CV Honesto</strong> — Transparencia y logros verificables.</li>
          <li><strong>Análisis psicológico</strong> — Perspectiva emocional sin diagnóstico clínico.</li>
          <li><strong>Autoevaluación profesional</strong> — Checklist de fortalezas y áreas de mejora.</li>
        </ul>
      </section>

      <section class="card" id="docs">
        <h2>Docs / Help</h2>
        <p>Lee la especificación y ejemplos para integrar IA-HASH en tus sistemas.</p>
        <div class="links">
          <a href="https://github.com/IAHASH/iahash/blob/main/docs/protocol.md" target="_blank">Protocolo</a>
          <a href="https://github.com/IAHASH/iahash/blob/main/docs/api.md" target="_blank">API</a>
          <a href="https://github.com/IAHASH/iahash/blob/main/docs/integration-examples.md" target="_blank">Integraciones</a>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>IA-HASH · SHA256 + Ed25519 · Neutral y offline-first</span>
    </footer>

    <script>
      const issueJson = document.getElementById("issue-json");
      const verifyJson = document.getElementById("verify-json");
      const issueStatus = document.getElementById("issue-status");
      const verifyStatus = document.getElementById("verify-status");
      const verifyBadge = document.getElementById("verify-badge");
      const verifyReason = document.getElementById("verify-reason");
      let lastIssued = null;

      function setIssueStatus(text) {
        issueStatus.textContent = text;
      }

      function setVerifyStatus(text) {
        verifyStatus.textContent = text;
      }

      async function postJSON(url, payload) {
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!response.ok) {
          const error = await response.text();
          throw new Error(error || "Request failed");
        }
        return response.json();
      }

      document.getElementById("btn-issue").addEventListener("click", async () => {
        const prompt = document.getElementById("prompt").value.trim();
        const respuesta = document.getElementById("response").value.trim();
        const modelo = document.getElementById("model").value.trim() || null;
        const promptId = document.getElementById("prompt-id").value.trim() || null;
        const subjectId = document.getElementById("subject-id").value.trim() || null;
        const conversationId = document.getElementById("conversation-id").value.trim() || null;

        if (!prompt || !respuesta) {
          setIssueStatus("Necesitas prompt y respuesta.");
          return;
        }

        try {
          setIssueStatus("Generando IA-HASH...");
          const doc = await postJSON("/issue", {
            prompt_maestro: prompt,
            respuesta,
            modelo,
            prompt_id: promptId,
            subject_id: subjectId,
            conversation_id: conversationId,
          });
          lastIssued = doc;
          issueJson.textContent = JSON.stringify(doc, null, 2);
          setIssueStatus("Documento emitido. Puedes copiar o descargar el JSON.");
          verifyBadge.textContent = "Sin verificar";
        } catch (err) {
          setIssueStatus(`Error: ${err.message}`);
        }
      });

      document.getElementById("btn-clear").addEventListener("click", () => {
        document.getElementById("prompt").value = "";
        document.getElementById("response").value = "";
        document.getElementById("model").value = "";
        document.getElementById("prompt-id").value = "";
        document.getElementById("subject-id").value = "";
        document.getElementById("conversation-id").value = "";
        issueJson.textContent = "{}";
        verifyJson.value = "";
        setIssueStatus("Listo para emitir.");
      });

      document.getElementById("btn-copy").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(issueJson.textContent);
          setIssueStatus("JSON copiado al portapapeles.");
        } catch (err) {
          setIssueStatus("No se pudo copiar (permiso denegado?).");
        }
      });

      document.getElementById("btn-download").addEventListener("click", () => {
        const blob = new Blob([issueJson.textContent], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "iah-document.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      document.getElementById("btn-use-last").addEventListener("click", () => {
        if (!lastIssued) {
          setVerifyStatus("No hay documento previo.");
          return;
        }
        verifyJson.value = JSON.stringify(lastIssued, null, 2);
        setVerifyStatus("Documento copiado desde el último emitido.");
      });

      document.getElementById("btn-verify").addEventListener("click", async () => {
        let payload;
        try {
          payload = JSON.parse(verifyJson.value);
        } catch (err) {
          setVerifyStatus("JSON inválido.");
          return;
        }
        try {
          setVerifyStatus("Verificando...");
          const result = await postJSON("/verify", payload);
          verifyBadge.textContent = result.valid ? "VÁLIDO" : "INVÁLIDO";
          verifyBadge.classList.toggle("badge-success", result.valid);
          verifyBadge.classList.toggle("badge-error", !result.valid);
          verifyReason.textContent = result.reason;
          setVerifyStatus("Verificación completada.");
        } catch (err) {
          setVerifyStatus(`Error: ${err.message}`);
        }
      });
    </script>
  </body>
</html>

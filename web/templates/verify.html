{% extends "base.html" %}
{% block title %}IA-HASH · Verificar{% endblock %}
{% block content %}
  <div class="section">
    <p class="pill">Verificación IA-HASH</p>
    <h2>Par directo, Prompt+URL y PK</h2>
    <p class="muted">Elige el flujo adecuado para validar un par texto/IA, una conversación de ChatGPT o una firma con PK URL.</p>
  </div>

  <div class="tabs">
    <button class="tab active" data-target="pair" onclick="showTab('pair')">Pair</button>
    <button class="tab" data-target="prompt-url" onclick="showTab('prompt-url')">Prompt+URL</button>
    <button class="tab" data-target="checker" onclick="showTab('checker')">Firma / PK URL</button>
  </div>

  <div class="tab-content" id="tab-pair">
    <div class="card">
      <div class="section-header">
        <div>
          <div class="badge">Pair</div>
          <h3>Prompt + Respuesta</h3>
          <p class="muted">Verifica un par directo (prompt + respuesta) sin URL externas.</p>
        </div>
      </div>
      <form class="form-grid" id="pair-form">
        <label class="field-block">
          <span class="field-label">Prompt</span>
          <textarea id="pair-prompt" class="input" rows="6" placeholder="Pega aquí el prompt exacto"></textarea>
        </label>
        <label class="field-block">
          <span class="field-label">Respuesta</span>
          <textarea id="pair-response" class="input" rows="8" placeholder="Respuesta completa de la IA"></textarea>
        </label>
        <div class="field-row">
          <label class="field-block">
            <span class="field-label">Modelo</span>
            <select id="pair-model" class="input">
              <option value="unknown" selected>unknown</option>
              <option value="gpt-4.1">gpt-4.1</option>
              <option value="gpt-4o">gpt-4o</option>
              <option value="claude-3.5">claude-3.5</option>
            </select>
          </label>
          <div class="field-block">
            <span class="field-label">&nbsp;</span>
            <button class="button" type="submit" id="pair-submit">Generar IA-HASH</button>
          </div>
        </div>
        <pre id="pair-log" class="muted result-raw"></pre>
      </form>
    </div>
  </div>

  <div class="tab-content" id="tab-prompt-url" style="display:none;">
    <div class="card">
      <div class="section-header">
        <div>
          <div class="badge">Prompt+URL</div>
          <h3>Conversación compartida</h3>
          <p class="muted">Selecciona un prompt maestro o pega el texto, y verifica una URL de conversación de ChatGPT.</p>
        </div>
      </div>
      <form class="form-grid" id="conversation-form">
        <label class="field-block">
          <span class="field-label">Prompt maestro</span>
          {% if prompts %}
            <select id="prompt-slug" class="input">
              <option value="">(opcional) Selecciona prompt maestro</option>
              {% for prompt in prompts %}
                <option value="{{ prompt.id }}" data-slug="{{ prompt.slug }}" data-h-public="{{ prompt.h_public or '' }}">{{ prompt.title }}</option>
              {% endfor %}
            </select>
            <p class="muted" id="prompt-meta" style="margin-top:6px;">
              <strong>Slug:</strong> <span data-meta="slug">—</span> · <strong>h_public:</strong> <span data-meta="h-public">—</span>
            </p>
          {% else %}
            <p class="muted">No hay prompts públicos todavía. Pega tu prompt manualmente abajo.</p>
          {% endif %}
        </label>
        <label class="field-block">
          <span class="field-label">Prompt pegado (opcional)</span>
          <textarea id="prompt-manual" class="input" rows="5" placeholder="Si no eliges un maestro, pega aquí el prompt usado en el chat."></textarea>
        </label>
        <label class="field-block">
          <span class="field-label">URL de conversación ChatGPT</span>
          <input id="conv-url" name="url_chatgpt" class="input" placeholder="https://chatgpt.com/share/..." title="Enlace público de chatgpt.com/share/…" />
        </label>
        <div class="field-row">
          <label class="field-block">
            <span class="field-label">Modelo</span>
            <select id="conv-model" class="input">
              <option value="unknown" selected>unknown</option>
              <option value="gpt-4.1">gpt-4.1</option>
              <option value="gpt-4o">gpt-4o</option>
              <option value="claude-3.5">claude-3.5</option>
            </select>
          </label>
          <label class="field-block">
            <span class="field-label">Proveedor</span>
            <select id="conv-provider" class="input">
              <option value="chatgpt" selected>chatgpt</option>
              <option value="unknown">unknown</option>
            </select>
          </label>
          <div class="field-block">
            <span class="field-label">&nbsp;</span>
            <button class="button" type="submit" id="conv-submit">Generar IA-HASH</button>
          </div>
        </div>
        <pre id="conv-log" class="muted result-raw"></pre>
      </form>
    </div>
  </div>

  <div class="tab-content" id="tab-checker" style="display:none;">
    <div class="card">
      <div class="section-header">
        <div>
          <div class="badge">PK URL</div>
          <h3>Verificación de firma</h3>
          <p class="muted">Pega el documento IA-HASH firmado y la URL de clave pública (PK URL) del emisor.</p>
        </div>
      </div>
      <form class="form-grid" id="checker-form">
        <label class="field-block">
          <span class="field-label">IA-HASH JSON</span>
          <textarea id="checker-json" class="input" rows="10" placeholder='{"iah_id":"...","h_total":"..."}'></textarea>
        </label>
        <label class="field-block">
          <span class="field-label">URL de clave pública (PK URL)</span>
          <input id="checker-pk-url" name="pk_url" class="input" placeholder="https://iahash.com/keys/issuer_ed25519.pub" title="No es una URL de conversación; apunta a la clave pública del emisor." />
        </label>
        <div class="field-row">
          <div class="field-block">
            <span class="field-label">&nbsp;</span>
            <button class="button" type="submit">Verificar</button>
          </div>
        </div>
        <pre id="checker-log" class="muted result-raw"></pre>
      </form>
    </div>
  </div>

  <div class="result-card" id="result-card" style="display:none;"></div>

  <script src="/static/js/iah_render.js"></script>
  <script src="/static/js/pair.js"></script>
  <script src="/static/js/checker.js"></script>
{% endblock %}

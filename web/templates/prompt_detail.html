{% extends "base.html" %}
{% block content %}
  <div class="section">
    <h2>{{ prompt.title }}</h2>
    <p class="muted">{{ prompt.description }}</p>
  </div>

  <div class="card">
    <h3>Prompt Maestro</h3>
    <textarea class="input" id="prompt-text" readonly style="height: 220px;">{{ prompt.full_prompt }}</textarea>
    <div class="muted" style="margin-top: 10px;">
      <div><strong>Slug:</strong> {{ prompt.slug }}</div>
      {% if prompt.h_public %}
        <div><strong>h_public:</strong> {{ prompt.h_public }}</div>
      {% endif %}
    </div>
    <button class="button" style="margin-top: 10px;" onclick="copyPrompt()">Copiar Prompt</button>
  </div>

  <div class="card">
    <h3>Generate IA-HASH</h3>
    <textarea id="response-text" class="input" placeholder="Pega aquí la respuesta generada por la IA" style="height: 160px;"></textarea>

    <div class="flex" style="margin-top: 10px; gap: 10px;">
      <input id="pair-model" class="input" placeholder="Modelo (ej: gpt-4o)" value="unknown">
      <label class="muted" style="align-self: center;">Prompt ID: {{ prompt.id }}</label>
    </div>

    <button class="button" style="margin-top: 10px;" onclick="generateIAHash({{ prompt.id }})">
      Generate IA-HASH
    </button>

    <pre id="pair-log" class="muted" style="margin-top: 10px;"></pre>
  </div>

  <div class="card">
    <h3>Verificar respuesta (ChatGPT link)</h3>
    <input id="conv-url" class="input" placeholder="https://chatgpt.com/share/..." style="margin-top: 10px;">

    <div class="flex" style="margin-top: 10px; gap: 10px;">
      <input id="conv-model" class="input" placeholder="Modelo (opcional)" value="unknown">
      <select id="conv-provider" class="input">
        <option value="chatgpt" selected>chatgpt</option>
        <option value="unknown">unknown</option>
      </select>
    </div>

    <!-- IMPORTANTE: ahora enviamos prompt.id, NO el slug -->
    <button class="button" style="margin-top: 10px;" onclick="verifyShareWithIAHASH({{ prompt.id }})">
      Verificar con IA-HASH
    </button>

    <div id="conv-result" class="result-card" style="display:none; margin-top: 10px;"></div>
    <pre id="conv-log" class="muted" style="margin-top: 10px;"></pre>
  </div>

  <div class="card">
    <h3>Historial de verificaciones</h3>
    <p class="muted">Próximamente: aquí aparecerán los últimos IA-HASH emitidos para este prompt.</p>
  </div>

  <script src="/static/js/iah_result.js"></script>
  <script src="/static/js/prompt_detail.js"></script>

{% endblock %}
